{"ast":null,"code":"import _regeneratorRuntime from\"/Users/charlyagudelo/Documents/proyDanny/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/charlyagudelo/Documents/proyDanny/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/charlyagudelo/Documents/proyDanny/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/charlyagudelo/Documents/proyDanny/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React from\"react\";import firebase from'../components/database/firebase';import{config}from\"../components/config/config\";var UserStateContext=React.createContext();var UserDispatchContext=React.createContext();function userReducer(state,action){switch(action.type){case\"LOGIN_SUCCESS\":return _objectSpread(_objectSpread({},state),{},{isAuthenticated:true});case\"SIGN_OUT_SUCCESS\":return _objectSpread(_objectSpread({},state),{},{isAuthenticated:false});default:{throw new Error(\"Unhandled action type: \".concat(action.type));}}}function UserProvider(_ref){var children=_ref.children;var _React$useReducer=React.useReducer(userReducer,{isAuthenticated:!!localStorage.getItem(\"id_token\")}),_React$useReducer2=_slicedToArray(_React$useReducer,2),state=_React$useReducer2[0],dispatch=_React$useReducer2[1];return/*#__PURE__*/React.createElement(UserStateContext.Provider,{value:state},/*#__PURE__*/React.createElement(UserDispatchContext.Provider,{value:dispatch},children));}function useUserState(){var context=React.useContext(UserStateContext);if(context===undefined){throw new Error(\"useUserState must be used within a UserProvider\");}return context;}function useUserDispatch(){var context=React.useContext(UserDispatchContext);if(context===undefined){throw new Error(\"useUserDispatch must be used within a UserProvider\");}return context;}export{UserProvider,useUserState,useUserDispatch,userLogin,userRegistry,userRegistrySave,signOut};// ###########################################################\nfunction userLogin(dispatch,email,password,history,setIsLoading,setError,setAnswer){if(email===''&&password===''){//Alert.alert('Campos vacíos', 'Ingresa tu correo y contraseña', [{ style: 'destructive' }])\nsetError(true);}else{setError(false);setIsLoading(true);firebase.auth().signInWithEmailAndPassword(email,password).then(function(res){console.log(res);console.log('User logged-in successfully!');setError(null);setIsLoading(false);dispatch({type:'LOGIN_SUCCESS'});history.push('/app/dashboard');}).catch(function(error){dispatch({type:\"LOGIN_FAILURE\"});setError(true);setIsLoading(false);console.log(error);});}}//Registry\nfunction userRegistry(history){history.push('/registry');}//function userRegistrySave(history, name,lastname,email,password,){\nfunction userRegistrySave(_x,_x2,_x3,_x4,_x5,_x6,_x7,_x8,_x9,_x10){return _userRegistrySave.apply(this,arguments);}function _userRegistrySave(){_userRegistrySave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(identification,name,lastname,email,password,password2,history,setIsLoading,setError,setAnswer){var response,json;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setError(false);setIsLoading(true);_context.next=5;return fetch(\"\".concat(config.APIFireBase,\"/api/user\"),{crossDomain:true,method:'POST',headers:{Accept:'application/json','Content-Type':'application/json',\"Access-Control-Allow-Origin\":\"*\",\"Access-Control-Allow-Methods\":\"DELETE, POST, GET, OPTIONS\"},body:JSON.stringify({id:identification,name:name,lastName:lastname,email:email,password:password})},{mode:\"cors\"});case 5:response=_context.sent;_context.next=8;return response;case 8:json=_context.sent;responseApi(json,setIsLoading,setError,setAnswer,history);_context.next=17;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);setError(true);setAnswer(true);console.error(_context.t0);case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return _userRegistrySave.apply(this,arguments);};function responseApi(res,setIsLoading,setError,setAnswer,history){console.log('esto es la respuesta',res.description,res.json());if(typeof res.error!=='undefined'){setIsLoading(false);setError(true);console.log('Upps!',res.error);}else{if(typeof res.status==='undefined'||res.status!==200){setIsLoading(false);setError(true);setAnswer(true);console.log(JSON.stringify(res));console.log('Upps!','Algo pasó, intenta de nuevo');}else{if(res.status==200){setError(null);setIsLoading(false);history.push('/app/dashboard');console.log('respuesta!!!!!!!!!',res);}else{setError(true);setIsLoading(false);setAnswer(true);console.log('Upps!','Algo pasó intenta de nuevo',res);}}}}function loginUser(dispatch,login,password,history,setIsLoading,setError){setError(false);setIsLoading(true);if(!!login&&!!password){setTimeout(function(){localStorage.setItem('id_token',1);setError(null);setIsLoading(false);dispatch({type:'LOGIN_SUCCESS'});history.push('/app/dashboard');},2000);}else{dispatch({type:\"LOGIN_FAILURE\"});setError(true);setIsLoading(false);}}function signOut(dispatch,history){localStorage.removeItem(\"id_token\");dispatch({type:\"SIGN_OUT_SUCCESS\"});history.push(\"/login\");}","map":{"version":3,"sources":["/Users/charlyagudelo/Documents/proyDanny/front/src/context/UserContext.js"],"names":["React","firebase","config","UserStateContext","createContext","UserDispatchContext","userReducer","state","action","type","isAuthenticated","Error","UserProvider","children","useReducer","localStorage","getItem","dispatch","useUserState","context","useContext","undefined","useUserDispatch","userLogin","userRegistry","userRegistrySave","signOut","email","password","history","setIsLoading","setError","setAnswer","auth","signInWithEmailAndPassword","then","res","console","log","push","catch","error","identification","name","lastname","password2","fetch","APIFireBase","crossDomain","method","headers","Accept","body","JSON","stringify","id","lastName","mode","response","json","responseApi","description","status","loginUser","login","setTimeout","setItem","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport firebase from '../components/database/firebase';\nimport { config } from \"../components/config/config\";\n\nvar UserStateContext = React.createContext();\nvar UserDispatchContext = React.createContext();\n\nfunction userReducer(state, action) {\n  switch (action.type) {\n    case \"LOGIN_SUCCESS\":\n      return { ...state, isAuthenticated: true };\n    case \"SIGN_OUT_SUCCESS\":\n      return { ...state, isAuthenticated: false };\n    default: {\n      throw new Error(`Unhandled action type: ${action.type}`);\n    }\n  }\n}\n\nfunction UserProvider({ children }) {\n  var [state, dispatch] = React.useReducer(userReducer, {\n    isAuthenticated: !!localStorage.getItem(\"id_token\"),\n  });\n\n  return (\n    <UserStateContext.Provider value={state}>\n      <UserDispatchContext.Provider value={dispatch}>\n        {children}\n      </UserDispatchContext.Provider>\n    </UserStateContext.Provider>\n  );\n}\n\nfunction useUserState() {\n  var context = React.useContext(UserStateContext);\n  if (context === undefined) {\n    throw new Error(\"useUserState must be used within a UserProvider\");\n  }\n  return context;\n}\n\nfunction useUserDispatch() {\n  var context = React.useContext(UserDispatchContext);\n  if (context === undefined) {\n    throw new Error(\"useUserDispatch must be used within a UserProvider\");\n  }\n  return context;\n}\n\nexport { UserProvider, useUserState, useUserDispatch, userLogin, userRegistry, userRegistrySave,signOut};\n\n// ###########################################################\n\nfunction userLogin (dispatch, email, password, history, setIsLoading, setError, setAnswer) {\n  if (email === '' && password === '') {\n    //Alert.alert('Campos vacíos', 'Ingresa tu correo y contraseña', [{ style: 'destructive' }])\n    setError(true);\n  } else {\n    setError(false);\n    setIsLoading(true);\n    firebase\n      .auth()\n      .signInWithEmailAndPassword(email, password)\n      .then((res) => {\n        console.log(res)\n        console.log('User logged-in successfully!')\n        setError(null)\n        setIsLoading(false)\n        dispatch({ type: 'LOGIN_SUCCESS' })\n        history.push('/app/dashboard')\n      })\n      .catch((error => {\n        dispatch({ type: \"LOGIN_FAILURE\" });\n        setError(true);\n        setIsLoading(false);\n          console.log(error)\n      }));\n  }\n}\n\n//Registry\n\nfunction userRegistry(history){\n  history.push('/registry')\n}\n\n//function userRegistrySave(history, name,lastname,email,password,){\nasync function userRegistrySave ( identification,name, lastname, email,password, password2, history,setIsLoading,setError, setAnswer ){\n  try {\n    setError(false);\n    setIsLoading(true);\n    let response = await fetch(\n      `${config.APIFireBase}/api/user`, {\n        crossDomain:true,\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Access-Control-Allow-Methods\": \"DELETE, POST, GET, OPTIONS\",\n        },\n\n        body: JSON.stringify({\n          id: identification,\n          name: name,\n          lastName: lastname,\n          email: email,\n          password: password\n        })\n      },\n      { mode: \"cors\" }\n    );\n    let json = await response;\n    responseApi(json, setIsLoading,setError, setAnswer,history);\n  } catch (error) {\n    setError(true);\n    setAnswer(true);\n    console.error(error);\n  }\n};\n\nfunction responseApi(res, setIsLoading,setError, setAnswer, history) {\n  console.log('esto es la respuesta',res.description, res.json())\n  if (typeof res.error!== 'undefined'){\n    setIsLoading(false);\n    setError(true);\n    console.log('Upps!', res.error)            \n  }else{\n    if(typeof res.status === 'undefined' || res.status!==200){\n      setIsLoading(false);\n      setError(true);\n      setAnswer(true);\n      console.log(JSON.stringify(res))\n      console.log('Upps!', 'Algo pasó, intenta de nuevo')      \n    }  else{\n      if(res.status==200){\n        setError(null);\n        setIsLoading(false);\n        history.push('/app/dashboard')\n        console.log('respuesta!!!!!!!!!', res)                   \n      } else{\n        setError(true);\n        setIsLoading(false)\n        setAnswer(true);\n        console.log('Upps!', 'Algo pasó intenta de nuevo', res)          \n      }\n    }    \n  }\n\n}\n\nfunction loginUser(dispatch, login, password, history, setIsLoading, setError) {\n  setError(false);\n  setIsLoading(true);\n  if (!!login && !!password) {\n    setTimeout(() => {\n      localStorage.setItem('id_token', 1)\n      setError(null)\n      setIsLoading(false)\n      dispatch({ type: 'LOGIN_SUCCESS' })\n\n      history.push('/app/dashboard')\n    }, 2000);\n  } else {\n    dispatch({ type: \"LOGIN_FAILURE\" });\n    setError(true);\n    setIsLoading(false);\n  }\n}\n\nfunction signOut(dispatch, history) {\n  localStorage.removeItem(\"id_token\");\n  dispatch({ type: \"SIGN_OUT_SUCCESS\" });\n  history.push(\"/login\");\n}\n"]},"metadata":{},"sourceType":"module"}